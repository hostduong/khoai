{% set title = "Đăng ký tài khoản | UnlimitMail.com - Hệ thống Email Tự Động" %}
{% set description = "Tạo tài khoản mới trên UnlimitMail.com – hệ thống email tự động, bảo mật cao, chuyên cho MMO và doanh nghiệp." %}
{% set keywords = "UnlimitMail, đăng ký email, hệ thống email tự động, MMO" %}
{% set canonical = "https://unlimitmail.com/register" %}
{% set og_image = "/img/logo.png" %}
<!DOCTYPE html>
<html lang="vi" class="light-style customizer-hide" dir="ltr" data-theme="theme-default2" data-assets-path="/img/">
{% include "head.njk" %}
<body class="bg-light">
  <div class="authentication-wrapper authentication-cover">
    <div class="authentication-inner row m-0">
      <!-- Left (logo + banner) -->
      <div class="d-none d-lg-flex col-lg-7 col-xl-8 align-items-center p-5 bg-white">
        <div class="w-100 d-flex justify-content-center">
          <img src="/img/register-illustration.png" alt="Register" style="max-width:440px;">
        </div>
      </div>
      <!-- /Left -->

      <!-- Register form -->
      <div class="d-flex col-12 col-lg-5 col-xl-4 align-items-center authentication-bg p-sm-5 p-4">
        <div class="w-px-400 mx-auto">
          <!-- Logo -->
          <div class="app-brand mb-4">
            <a href="/" class="app-brand-link gap-2">
              <img src="/img/logo.png" alt="UnlimitMail" height="40" style="margin-right: 10px;">
              <span class="app-brand-text text-body fw-bolder">UnlimitMail</span>
            </a>
          </div>
          <!-- /Logo -->
          <h4 class="mb-2">Đăng ký tài khoản</h4>
          <form id="registerForm" class="mb-3" autocomplete="off">
            <div class="mb-3">
              <label for="fullname" class="form-label">Họ và tên</label>
              <input type="text" class="form-control" id="fullname" name="fullname" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email đăng ký</label>
              <input type="email" class="form-control" id="email" name="email" required autocomplete="email">
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Mật khẩu</label>
              <input type="password" class="form-control" id="password" name="password" minlength="8" required autocomplete="new-password">
            </div>
            <div class="mb-3">
              <label for="phone" class="form-label">Số điện thoại</label>
              <input type="text" class="form-control" id="phone" name="phone" required>
            </div>
            <div class="mb-3">
              <label for="pin" class="form-label">Mã PIN (6 số)</label>
              <input type="text" class="form-control" id="pin" name="pin" required maxlength="6" pattern="\d{6}">
            </div>
            <div id="regAlert" class="alert alert-danger d-none py-2" role="alert"></div>
            <button type="submit" class="btn btn-primary d-block w-100">Tạo tài khoản</button>
          </form>
          <p class="text-center">
            <span>Đã có tài khoản?</span>
            <a href="/login.html">
              <span>Đăng nhập ngay</span>
            </a>
          </p>
          {% include "footer.njk" %}
        </div>
      </div>
      <!-- /Register form -->
    </div>
  </div>

  <!-- Core JS -->
  <script src="/js/jquery.min.js"></script>
  <script src="/js/helpers.js"></script>
  <script src="/js/template-customizer.js"></script>
  <script src="/js/front-config.js"></script>
  <script src="/js/register.js"></script>
  <script>
    // JS xử lý form đăng ký (nếu muốn inline thay vì file js riêng)
    const regForm = document.getElementById('registerForm');
    const regAlert = document.getElementById('regAlert');
    regForm.onsubmit = async function(e) {
      e.preventDefault();
      regAlert.classList.add('d-none');
      regAlert.innerText = '';
      const data = {
        fullname: regForm.fullname.value.trim(),
        email: regForm.email.value.trim(),
        password: regForm.password.value,
        phone: regForm.phone.value.trim(),
        pin: regForm.pin.value.trim()
      };
      if(!/^\d{6}$/.test(data.pin)) {
        regAlert.innerText = "Mã PIN phải gồm đúng 6 số.";
        regAlert.classList.remove('d-none');
        return;
      }
      if(data.password.length < 8) {
        regAlert.innerText = "Mật khẩu tối thiểu 8 ký tự.";
        regAlert.classList.remove('d-none');
        return;
      }
      try {
        const res = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if(result.ok) {
          regAlert.classList.remove('alert-danger');
          regAlert.classList.add('alert-success');
          regAlert.innerText = "Tạo tài khoản thành công! Bạn sẽ được chuyển tới trang đăng nhập...";
          regAlert.classList.remove('d-none');
          setTimeout(() => window.location.href = '/login.html', 2000);
        } else {
          regAlert.innerText = result.message || 'Có lỗi xảy ra, thử lại sau!';
          regAlert.classList.remove('d-none');
          regAlert.classList.add('alert-danger');
        }
      } catch(err) {
        regAlert.innerText = "Không kết nối được máy chủ. Vui lòng thử lại.";
        regAlert.classList.remove('d-none');
      }
    }
  </script>
</body>
</html>
