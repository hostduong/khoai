{% set title = "Đăng ký tài khoản | UnlimitMail.com - Hệ thống Email Tự Động" %}
{% set description = "Tạo tài khoản mới trên UnlimitMail.com – hệ thống email tự động, bảo mật cao, chuyên cho MMO và doanh nghiệp." %}
{% set keywords = "UnlimitMail, đăng ký email, hệ thống email tự động, MMO" %}
{% set canonical = "https://unlimitmail.com/register" %}
{% set og_image = "/img/logo.png" %}
<!DOCTYPE html>
<html lang="vi">
  {% include "head-meta.njk" %}
  <body class="bg-light">
    {% include "head.njk" %}

    <div class="container my-5">
      <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
          <div class="card shadow-sm border-0">
            <div class="card-body p-4">
              <h2 class="mb-3 text-center">Đăng ký tài khoản</h2>
              <form id="registerForm" autocomplete="off">
                <div class="mb-3">
                  <label for="fullname" class="form-label">Họ và tên</label>
                  <input type="text" class="form-control" id="fullname" name="fullname" required>
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label">Email đăng ký</label>
                  <input type="email" class="form-control" id="email" name="email" required autocomplete="email">
                </div>
                <div class="mb-3">
                  <label for="password" class="form-label">Mật khẩu</label>
                  <input type="password" class="form-control" id="password" name="password" minlength="8" required autocomplete="new-password">
                </div>
                <div class="mb-3">
                  <label for="phone" class="form-label">Số điện thoại</label>
                  <input type="text" class="form-control" id="phone" name="phone" required>
                </div>
                <div class="mb-3">
                  <label for="pin" class="form-label">Mã PIN (6 số)</label>
                  <input type="text" class="form-control" id="pin" name="pin" required maxlength="6" pattern="\d{6}">
                </div>
                <div id="regAlert" class="alert alert-danger d-none py-2" role="alert"></div>
                <button type="submit" class="btn btn-primary w-100">Tạo tài khoản</button>
              </form>
              <div class="mt-3 text-center">
                Đã có tài khoản? <a href="/login">Đăng nhập ngay</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {% include "footer.njk" %}

    <script>
      const regForm = document.getElementById('registerForm');
      const regAlert = document.getElementById('regAlert');
      regForm.onsubmit = async function(e) {
        e.preventDefault();
        regAlert.classList.add('d-none');
        regAlert.innerText = '';
        const data = {
          fullname: regForm.fullname.value.trim(),
          email: regForm.email.value.trim(),
          password: regForm.password.value,
          phone: regForm.phone.value.trim(),
          pin: regForm.pin.value.trim()
        };
        if(!/^\d{6}$/.test(data.pin)) {
          regAlert.innerText = "Mã PIN phải gồm đúng 6 số.";
          regAlert.classList.remove('d-none');
          return;
        }
        if(data.password.length < 8) {
          regAlert.innerText = "Mật khẩu tối thiểu 8 ký tự.";
          regAlert.classList.remove('d-none');
          return;
        }
        try {
          const res = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          const result = await res.json();
          if(result.ok) {
            regAlert.classList.remove('alert-danger');
            regAlert.classList.add('alert-success');
            regAlert.innerText = "Tạo tài khoản thành công! Bạn sẽ được chuyển tới trang đăng nhập...";
            regAlert.classList.remove('d-none');
            setTimeout(() => window.location.href = '/login', 2000);
          } else {
            regAlert.innerText = result.message || 'Có lỗi xảy ra, thử lại sau!';
            regAlert.classList.remove('d-none');
            regAlert.classList.add('alert-danger');
          }
        } catch(err) {
          regAlert.innerText = "Không kết nối được máy chủ. Vui lòng thử lại.";
          regAlert.classList.remove('d-none');
        }
      }
    </script>
  </body>
</html>
